<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verificador EC</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <!-- ====== HEADER ====== -->
  <header id="header">
    <div class="header-row">
      <div class="logo">
        <!-- EC Logo mark -->
        <div class="ec-logo-mark">
          <span class="ec-text">EC</span>
        </div>
        <div class="logo-text">
          <h1>Verificador <span class="ec-brand">EC</span></h1>
          <span class="logo-sub">El Comercio · Perú</span>
        </div>
      </div>
      <button id="settingsBtn" class="icon-btn" title="Configuración">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
    </div>
    <div id="statusBar" class="status-bar">
      <span class="status-dot" id="statusDot"></span>
      <span id="statusText">Listo</span>
    </div>
    <div id="progressWrap" class="progress-wrap hidden">
      <div class="progress-track">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <span class="progress-label" id="progressLabel">0%</span>
    </div>
  </header>

  <!-- ====== SETTINGS PANEL ====== -->
  <div id="settingsPanel" class="settings-panel hidden">
    <div class="settings-group">
      <label>Clave API de Gemini</label>
      <input type="password" id="apiKeyInput" placeholder="AIza..." spellcheck="false">
      <p class="hint">Obtén una clave gratuita en <a href="https://aistudio.google.com/apikey" target="_blank">Google AI Studio</a></p>
    </div>
    <div class="settings-group">
      <label>Intervalo de verificación</label>
      <div class="radio-row">
        <label class="radio-label"><input type="radio" name="interval" value="5000"> ~5s</label>
        <label class="radio-label"><input type="radio" name="interval" value="10000" checked> ~10s</label>
        <label class="radio-label"><input type="radio" name="interval" value="20000"> ~20s</label>
      </div>
    </div>
    <div class="settings-group">
      <label>Idioma de análisis</label>
      <select id="langSelect" class="select-input">
        <option value="es">Español (recomendado)</option>
        <option value="en">English</option>
      </select>
    </div>
    <div class="settings-group">
      <label>Modo de transcripción</label>
      <div class="radio-row" style="flex-direction:column;gap:6px">
        <label class="radio-label"><input type="radio" name="mode" value="youtube" checked> Subtítulos YouTube (lee CC directamente)</label>
        <label class="radio-label"><input type="radio" name="mode" value="tab_audio"> Audio de pestaña (Whisper local — cualquier pestaña)</label>
        <label class="radio-label"><input type="radio" name="mode" value="mic"> Micrófono (Web Speech API)</label>
      </div>
    </div>
    <button id="saveSettingsBtn" class="btn btn-sm">Guardar configuración</button>
  </div>

  <!-- ====== CONTEXT EDITOR ====== -->
  <div id="contextSection" class="context-section">
    <button id="contextToggle" class="section-toggle">
      <svg class="chevron" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
      <span>Contexto</span>
      <span id="contextBadge" class="badge">auto-detectado</span>
    </button>
    <div id="contextFields" class="context-fields hidden">
      <div class="field">
        <label>Orador / Canal</label>
        <input type="text" id="ctxSpeaker" placeholder="ej. Dina Boluarte, RPP Noticias">
      </div>
      <div class="field">
        <label>Evento / Tema</label>
        <input type="text" id="ctxEvent" placeholder="ej. Debate presidencial 2026, Informe Perú">
      </div>
      <div class="field">
        <label>Contexto adicional</label>
        <textarea id="ctxCustom" rows="2" placeholder="Información extra que la IA deba considerar..."></textarea>
      </div>
    </div>
  </div>

  <!-- ====== CONTROLS ====== -->
  <div class="controls">
    <button id="startBtn" class="btn btn-primary btn-lg">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
      <span>Iniciar Verificación</span>
    </button>
    <button id="stopBtn" class="btn btn-danger btn-lg hidden">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
      <span>Detener</span>
    </button>
    <button id="clearBtn" class="btn btn-sm btn-ghost">Limpiar</button>
    <button id="analyzeNowBtn" class="btn btn-sm btn-accent-outline" title="Analizar video completo">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
      <span>Analizar Video</span>
    </button>
    <button id="exportBtn" class="btn btn-sm btn-ghost" title="Exportar reporte" style="margin-left:auto">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      <span>Exportar</span>
    </button>
  </div>

  <!-- ====== STATS BAR ====== -->
  <div id="statsBar" class="stats-bar hidden">
    <div class="stat">
      <span class="stat-value" id="statWords">0</span>
      <span class="stat-label">palabras</span>
    </div>
    <div class="stat">
      <span class="stat-value" id="statClaims">0</span>
      <span class="stat-label">afirmaciones</span>
    </div>
    <div class="stat stat-true">
      <span class="stat-value" id="statTrue">0</span>
      <span class="stat-label">verdad</span>
    </div>
    <div class="stat stat-false">
      <span class="stat-value" id="statFalse">0</span>
      <span class="stat-label">falso</span>
    </div>
    <div class="stat stat-uncertain">
      <span class="stat-value" id="statUncertain">0</span>
      <span class="stat-label">incierto</span>
    </div>
  </div>

  <!-- ====== CLARIFICATION BANNER ====== -->
  <div id="clarificationBanner" class="clarification-banner hidden">
    <div class="clarification-header">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      <span>La IA necesita tu ayuda</span>
      <button id="dismissClarification" class="icon-btn-sm">&times;</button>
    </div>
    <p id="clarificationQuestion"></p>
    <div class="clarification-input-row">
      <input type="text" id="clarificationInput" placeholder="Escribe tu respuesta...">
      <button id="submitClarification" class="btn btn-sm btn-primary">Enviar</button>
    </div>
  </div>

  <!-- ====== TRANSCRIPT ====== -->
  <div id="transcriptContainer" class="transcript-container">
    <div id="transcript" class="transcript">
      <p class="placeholder-text">La transcripción aparecerá aquí al iniciar la verificación...</p>
    </div>
  </div>

  <!-- ====== CLAIM HOVER TOOLTIP ====== -->
  <div id="claimTooltip" class="claim-tooltip hidden">
    <div class="ct-verdict"></div>
    <div class="ct-summary"></div>
    <div class="ct-sources"></div>
    <div class="ct-footer"></div>
  </div>

  <!-- ====== CLAIM DETAIL MODAL ====== -->
  <div id="claimModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <button id="closeModal" class="modal-close">&times;</button>
      <div id="modalVerdict" class="modal-verdict"></div>
      <blockquote id="modalClaim" class="modal-claim"></blockquote>
      <div id="modalExplanation" class="modal-explanation"></div>
      <div id="modalSources" class="modal-sources"></div>
      <div id="modalConfidence" class="modal-confidence"></div>
    </div>
  </div>

  <!-- ====== FOOTER ====== -->
  <footer class="app-footer">
    <span>Verificador EC</span> &middot; <a href="https://elcomercio.pe" target="_blank">El Comercio</a> &middot; <span class="footer-dim">Powered by Gemini</span>
  </footer>

  <script src="sidepanel.js"></script>
</body>
</html>
